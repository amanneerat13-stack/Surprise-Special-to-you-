<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Propose ‚Äî I ‚ù§Ô∏è You (Enhanced)</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Dancing+Script:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg1:#fff5f8;--bg2:#fff0f6;--accent:#d6336c;--accent-dark:#a81246}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Playfair Display',serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#3b2230}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:980px;border-radius:18px;padding:18px;background:rgba(255,255,255,0.9);box-shadow:0 18px 60px rgba(145,64,92,0.12);display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:center}
    @media(max-width:900px){.card{grid-template-columns:1fr;}}
    h1{font-size:2.2rem;margin:0;color:var(--accent-dark);font-weight:700}
    p.lead{margin:8px 0 16px;color:#5f3f4a}
    .controls{display:flex;gap:8px;align-items:center}
    input[type=text]{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #fde7ef;font-size:1rem;background:linear-gradient(180deg,#fff,#fff6f9)}
    button.btn{padding:10px 14px;border-radius:12px;border:none;background:var(--accent);color:white;font-weight:700;cursor:pointer}
    .small{font-size:0.9rem;color:#7b5864}
    .preview-wrap{display:flex;flex-direction:column;gap:12px;align-items:center}
    .card-preview{width:100%;max-width:420px;border-radius:16px;padding:26px;background:linear-gradient(180deg,#fff,#fff0f6);box-shadow:0 12px 40px rgba(214,78,126,0.08);text-align:center;position:relative;overflow:hidden}
    .title-love{font-family:'Dancing Script',cursive;font-size:2.8rem;color:var(--accent-dark);opacity:0;transform:translateY(12px);transition:all 600ms cubic-bezier(.2,.9,.3,1)}
    .name-large{font-size:2rem;font-weight:800;color:#7a1338;margin-top:6px;opacity:0;transform:translateY(12px);transition:all 650ms cubic-bezier(.2,.9,.3,1)}
    .heart{position:absolute;right:14px;top:12px;font-size:28px;transform-origin:center;animation:beat 1s infinite}
    @keyframes beat{0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .share-url{word-break:break-all;background:#fff7fb;padding:8px;border-radius:10px;border:1px dashed #ffd6ea;font-size:0.9rem}
    /* floating petals canvas sits inside preview */
    .petal{position:absolute;width:28px;height:28px;pointer-events:none}
    /* audio controller */
    .audio-control{display:flex;gap:8px;align-items:center}
    .mute{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:10px}
    footer{font-size:0.85rem;color:#7d5564;margin-top:6px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <div>
        <h1>Romantic Propose Form</h1>
        <p class="lead">Naam daaliye ‚Äî preview dekhiye. "Download Image" se high-quality PNG le sakte ho. Upar se phool ki barish, animation aur soft music bhi hai.</p>

        <div class="controls" aria-label="propose controls">
          <input id="nameInput" type="text" placeholder="Jaise: Priya" aria-label="Name input" />
          <button id="makeBtn" class="btn">Banao</button>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input id="messageInput" type="text" placeholder="Custom message: e.g., Will you marry me" style="flex:1;padding:10px;border-radius:10px;border:1px solid #fde7ef" />
          <input id="emojiInput" type="text" placeholder="Emoji" value="‚ù§Ô∏è" style="width:84px;padding:10px;border-radius:10px;border:1px solid #fde7ef;text-align:center" />
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
          <div class="audio-control">
            <button id="playAudio" class="btn">Play Music</button>
            <button id="toggleMute" class="mute">Mute</button>
          </div>
          <div style="flex:1" class="small">Music is generated in-browser (no external file). Muted by default.</div>
        </div>

        <div style="margin-top:14px">
          <label class="small">Shareable link:</label>
          <div id="urlBox" style="display:none;margin-top:8px"><div class="share-url" id="shareUrl"></div></div>
        </div>
      </div>

      <div class="preview-wrap">
        <div id="preview" class="card-preview" aria-live="polite">
          <div class="heart">üíò</div>
          <div id="petalLayer"></div>
          <div class="title-love" id="titleLove">I love you</div>
          <div id="nameLarge" class="name-large">‚Äî Your Name ‚Äî</div>
          <div class="muted" style="margin-top:12px">Share karo ya image download karo</div>
        </div>

        <div class="actions">
          <button id="shareBtn" class="btn">Copy Share URL</button>
          <button id="downloadBtn" class="btn">Download Image</button>
          <button id="surpriseBtn" class="btn" style="background:var(--accent-dark)">Confetti!</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Elements
    const nameInput = document.getElementById('nameInput');
    const makeBtn = document.getElementById('makeBtn');
    const nameLarge = document.getElementById('nameLarge');
    const preview = document.getElementById('preview');
    const titleLove = document.getElementById('titleLove');
    const messageInput = document.getElementById('messageInput');
    const emojiInput = document.getElementById('emojiInput');
    const shareBtn = document.getElementById('shareBtn');
    const shareUrl = document.getElementById('shareUrl');
    const urlBox = document.getElementById('urlBox');
    const downloadBtn = document.getElementById('downloadBtn');
    const playAudio = document.getElementById('playAudio');
    const toggleMute = document.getElementById('toggleMute');
    const petalLayer = document.getElementById('petalLayer');

    // Animate text entry
    function showAnimatedText(name){
      titleLove.style.opacity = '0'; titleLove.style.transform='translateY(12px)';
      nameLarge.style.opacity = '0'; nameLarge.style.transform='translateY(12px)';
      setTimeout(()=>{ titleLove.textContent = messageInput.value.trim() || 'I love you'; titleLove.style.opacity='1'; titleLove.style.transform='translateY(0)'; },80);
      setTimeout(()=>{ nameLarge.textContent = name; nameLarge.style.opacity='1'; nameLarge.style.transform='translateY(0)'; },220);
    }

    // Petal system
    const petals = [];
    function createPetal(){
      const p = document.createElement('div');
      p.className='petal';
      p.innerHTML = `<svg viewBox="0 0 24 24" width="28" height="28" xmlns="http://www.w3.org/2000/svg"><path d="M12 2c2 4 8 4 8 9 0 6-10 11-10 11s-10-5-10-11c0-5 6-5 10-9z" fill="rgba(214,78,126,0.92)"/></svg>`;
      p.style.left = Math.random()*100 + '%';
      p.style.top = '-10%';
      p.style.opacity = Math.random()*0.9 + 0.3;
      p.style.transform = `rotate(${Math.random()*360}deg)`;
      petalLayer.appendChild(p);
      const obj = {el:p,x:p.offsetLeft || 0,y:-20, vx:(Math.random()-0.5)*0.6, vy:1+Math.random()*2, rot:Math.random()*6};
      petals.push(obj);
      // keep petals limited
      if(petals.length>120){ const old = petals.shift(); if(old && old.el) old.el.remove(); }
    }

    function updatePetals(){
      for(let i=0;i<petals.length;i++){
        const o = petals[i];
        o.y += o.vy; o.x += o.vx; o.rot += (Math.random()-0.5)*0.6;
        if(o.el){ o.el.style.top = o.y + 'px'; o.el.style.left = (o.x) + 'px'; o.el.style.transform = `rotate(${o.rot}deg)`; }
        if(o.y > preview.clientHeight + 60){ o.el.remove(); petals.splice(i,1); i--; }
      }
    }

    let petalInterval = setInterval(()=>{ createPetal(); }, 220);
    let petalAnim = setInterval(()=>{ updatePetals(); }, 40);

    // Share URL builder
    function buildUrl(name){
      const url = location.origin + location.pathname + '?name=' + encodeURIComponent(name) + '&msg=' + encodeURIComponent(messageInput.value || '') + '&emo=' + encodeURIComponent(emojiInput.value || '‚ù§Ô∏è');
      return url;
    }

    function copyToClipboard(text){ if(navigator.clipboard) return navigator.clipboard.writeText(text); const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); return Promise.resolve(); }

    makeBtn.addEventListener('click', ()=>{
      const name = nameInput.value.trim(); if(!name){ alert('Pehele naam daalo.'); nameInput.focus(); return; }
      showAnimatedText(name);
      const url = buildUrl(name);
      shareUrl.textContent = url; urlBox.style.display='block'; history.replaceState({},'',location.pathname + '?name=' + encodeURIComponent(name));
    });

    shareBtn.addEventListener('click', async ()=>{
      const name = nameInput.value.trim() || (new URLSearchParams(location.search)).get('name'); if(!name){ alert('Pehele naam daalo.'); return; }
      const url = buildUrl(name); await copyToClipboard(url); shareUrl.textContent = url; urlBox.style.display='block'; alert('Share URL copied to clipboard!');
    });

    // Download using html2canvas
    downloadBtn.addEventListener('click', ()=>{
      // briefly highlight for better image
      preview.style.boxShadow = '0 20px 80px rgba(214,78,126,0.18)';
      html2canvas(preview, {useCORS:true, scale:2}).then(canvas=>{
        const link = document.createElement('a');
        link.download = (nameInput.value.trim() || 'proposal') + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        preview.style.boxShadow = '';
      }).catch(err=>{ alert('Image generate nahi ho paya: '+err); preview.style.boxShadow = ''; });
    });

    // Confetti small
    document.getElementById('surpriseBtn').addEventListener('click', ()=>{ runConfetti(); });
    function runConfetti(){ const count=80; for(let i=0;i<count;i++){ createPetal(); } }

    // Onload params
    (function(){ const params = new URLSearchParams(location.search); const q = params.get('name'); const m = params.get('msg'); const e = params.get('emo'); if(m) messageInput.value = decodeURIComponent(m); if(e) emojiInput.value = decodeURIComponent(e); if(q){ nameInput.value = q; showAnimatedText(q); const url = buildUrl(q); shareUrl.textContent = url; urlBox.style.display='block'; } })();

    // Simple soft music using WebAudio
    let audioCtx, masterGain, isPlaying=false, isMuted=true, oscNodes=[];
    function initAudio(){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); masterGain = audioCtx.createGain(); masterGain.gain.value = 0.06; masterGain.connect(audioCtx.destination); }
    function playMusic(){ if(!audioCtx) initAudio(); if(isPlaying) return; isPlaying=true; // create soft arpeggio
      const now = audioCtx.currentTime;
      const freqs = [330, 392, 523, 659]; // soft chord set
      freqs.forEach((f,i)=>{ const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sine'; o.frequency.value = f; g.gain.value = 0.0; o.connect(g); g.connect(masterGain); o.start(now + i*0.15); g.gain.linearRampToValueAtTime(0.03, now + 0.2 + i*0.1); g.gain.exponentialRampToValueAtTime(0.0001, now + 6 + i*0.3); o.stop(now + 8 + i*0.3); oscNodes.push(o); });
      // loop gently
      setInterval(()=>{ if(!isPlaying) return; playMusic(); }, 7000);
    }
    playAudio.addEventListener('click', ()=>{ if(!isPlaying){ playMusic(); isMuted=false; toggleMute.textContent='Unmute'; alert('Music started (muted by default earlier). Use Mute/Unmute to toggle.'); } else { alert('Music already playing.'); } });
    toggleMute.addEventListener('click', ()=>{ if(!masterGain){ alert('Play music first.'); return; } isMuted = !isMuted; masterGain.gain.value = isMuted?0:0.06; toggleMute.textContent = isMuted? 'Muted' : 'Unmute'; });

    // Enter key
    nameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); makeBtn.click(); } });
  </script>
</body>
</html>
